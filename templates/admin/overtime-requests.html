{% extends "admin/base.html" %}

{% block title %}Admin Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% set breadcrumb1 = "Dashboard" %}
{% set breadcrumb2 = "" %}

{% block content %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="page-title">
                        <h1 class="mb-1">Overtime Requests</h1>
                        <p class="mb-0 text-muted">Approve or reject employee overtime requests and manage extended work schedules</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="page-actions d-flex justify-content-md-end gap-3 mt-3 mt-md-0">
                        <div class="search-container flex-grow-1 flex-md-grow-0">
                            <input type="text" class="form-control" placeholder="Search requests..." id="overtimeSearch">
                        </div>
                        <button class="btn btn-success add-overtime-btn">
                            <i class="fas fa-plus me-2"></i>Add Request
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section mb-4">
            <div class="row g-3">
                <div class="col-xl-3 col-lg-6 col-md-6">
                    <div class="stat-card h-100">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="stat-title">Pending Requests</span>
                            <div class="stat-icon pending-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-value">18</div>
                        <div class="stat-change negative">+5 from yesterday</div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6">
                    <div class="stat-card h-100">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="stat-title">Approved Today</span>
                            <div class="stat-icon present-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-value">12</div>
                        <div class="stat-change positive">+3 from yesterday</div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6">
                    <div class="stat-card h-100">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="stat-title">Total OT Hours</span>
                            <div class="stat-icon late-icon">
                                <i class="fas fa-business-time"></i>
                            </div>
                        </div>
                        <div class="stat-value">156</div>
                        <div class="stat-change positive">This week</div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6">
                    <div class="stat-card h-100">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="stat-title">Rejected</span>
                            <div class="stat-icon total-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                        </div>
                        <div class="stat-value">3</div>
                        <div class="stat-change neutral">This week</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="content-card mb-4">
            <div class="card-body">
                <div class="row g-3 align-items-center">
                    <div class="col-md-3">
                        <label class="form-label">Date Range</label>
                        <input type="date" class="form-control" id="dateFilter" value="2025-01-15">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Department</label>
                        <select class="form-select" id="departmentFilter">
                            <option value="">All Departments</option>
                            <option value="engineering">Engineering</option>
                            <option value="marketing">Marketing</option>
                            <option value="sales">Sales</option>
                            <option value="hr">HR</option>
                            <option value="finance">Finance</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">&nbsp;</label>
                        <button class="btn btn-outline-secondary w-100" id="clearFilters">
                            <i class="fas fa-times me-2"></i>Clear Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overtime Requests Table -->
        <div class="content-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Overtime Requests</h2>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" id="refreshRequests">
                        <i class="fas fa-sync me-1"></i>Refresh
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">Employee</th>
                                <th>Department</th>
                                <th>Date</th>
                                <th>Time Range</th>
                                <th>OT Hours</th>
                                <th>Reason</th>
                                <th>Status</th>
                                <th>Requested</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="overtimeTableBody">
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar me-3">JS</div>
                                        <div>
                                            <div class="user-name">John Smith</div>
                                            <div class="user-email">john.smith@company.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="department-badge engineering">Engineering</span>
                                </td>
                                <td>
                                    <div class="date-display">
                                        <div class="fw-medium">Jan 16, 2025</div>
                                        <small class="text-muted">Tomorrow</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="time-range">
                                        <div class="fw-medium">5:00 PM - 9:00 PM</div>
                                        <small class="text-muted">After regular hours</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="ot-hours">
                                        <div class="fw-medium text-info">4.0 hrs</div>
                                        <small class="text-muted">Overtime</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="reason-text">
                                        <div class="fw-medium">Project Deadline</div>
                                        <small class="text-muted">Critical deployment</small>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge pending">Pending</span>
                                </td>
                                <td>
                                    <div class="request-time">
                                        <div class="fw-medium">2 hours ago</div>
                                        <small class="text-muted">Jan 15, 2:30 PM</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-success" title="Approve">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Reject">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar me-3">MJ</div>
                                        <div>
                                            <div class="user-name">Maria Johnson</div>
                                            <div class="user-email">maria.johnson@company.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="department-badge marketing">Marketing</span>
                                </td>
                                <td>
                                    <div class="date-display">
                                        <div class="fw-medium">Jan 15, 2025</div>
                                        <small class="text-muted">Today</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="time-range">
                                        <div class="fw-medium">6:00 PM - 10:00 PM</div>
                                        <small class="text-muted">Evening shift</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="ot-hours">
                                        <div class="fw-medium text-success">4.0 hrs</div>
                                        <small class="text-success">Approved</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="reason-text">
                                        <div class="fw-medium">Campaign Launch</div>
                                        <small class="text-muted">Marketing event</small>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge approved">Approved</span>
                                </td>
                                <td>
                                    <div class="request-time">
                                        <div class="fw-medium">Yesterday</div>
                                        <small class="text-muted">Jan 14, 3:15 PM</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar me-3">RB</div>
                                        <div>
                                            <div class="user-name">Robert Brown</div>
                                            <div class="user-email">robert.brown@company.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="department-badge sales">Sales</span>
                                </td>
                                <td>
                                    <div class="date-display">
                                        <div class="fw-medium">Jan 13, 2025</div>
                                        <small class="text-muted">2 days ago</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="time-range">
                                        <div class="fw-medium">6:00 PM - 11:00 PM</div>
                                        <small class="text-muted">Extended hours</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="ot-hours">
                                        <div class="fw-medium text-primary">5.0 hrs</div>
                                        <small class="text-primary">Completed</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="reason-text">
                                        <div class="fw-medium">Client Meeting</div>
                                        <small class="text-muted">International client</small>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge completed">Completed</span>
                                </td>
                                <td>
                                    <div class="request-time">
                                        <div class="fw-medium">3 days ago</div>
                                        <small class="text-muted">Jan 12, 1:45 PM</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar me-3">SD</div>
                                        <div>
                                            <div class="user-name">Sarah Davis</div>
                                            <div class="user-email">sarah.davis@company.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="department-badge hr">HR</span>
                                </td>
                                <td>
                                    <div class="date-display">
                                        <div class="fw-medium">Jan 17, 2025</div>
                                        <small class="text-muted">In 2 days</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="time-range">
                                        <div class="fw-medium">5:30 PM - 8:30 PM</div>
                                        <small class="text-muted">Evening work</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="ot-hours">
                                        <div class="fw-medium text-danger">3.0 hrs</div>
                                        <small class="text-danger">Rejected</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="reason-text">
                                        <div class="fw-medium">Training Session</div>
                                        <small class="text-muted">Staff development</small>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge rejected">Rejected</span>
                                </td>
                                <td>
                                    <div class="request-time">
                                        <div class="fw-medium">1 hour ago</div>
                                        <small class="text-muted">Jan 15, 3:45 PM</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar me-3">AL</div>
                                        <div>
                                            <div class="user-name">Alex Lee</div>
                                            <div class="user-email">alex.lee@company.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="department-badge finance">Finance</span>
                                </td>
                                <td>
                                    <div class="date-display">
                                        <div class="fw-medium">Jan 18, 2025</div>
                                        <small class="text-muted">In 3 days</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="time-range">
                                        <div class="fw-medium">7:00 PM - 12:00 AM</div>
                                        <small class="text-muted">Late night</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="ot-hours">
                                        <div class="fw-medium text-warning">5.0 hrs</div>
                                        <small class="text-muted">Pending</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="reason-text">
                                        <div class="fw-medium">Month-end Closing</div>
                                        <small class="text-muted">Financial reports</small>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge pending">Pending</span>
                                </td>
                                <td>
                                    <div class="request-time">
                                        <div class="fw-medium">30 min ago</div>
                                        <small class="text-muted">Jan 15, 4:15 PM</small>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-success" title="Approve">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Reject">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between align-items-center">
                <div class="showing-info">
                    Showing 1-5 of 23 overtime requests
                </div>
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item disabled">
                            <span class="page-link">Previous</span>
                        </li>
                        <li class="page-item active">
                            <span class="page-link">1</span>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Add Overtime Request Modal -->
    <div class="modal fade" id="addOvertimeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Overtime Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addOvertimeForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="addEmployee" class="form-label">Employee</label>
                                <select class="form-select" id="addEmployee" required>
                                    <option value="">Select Employee</option>
                                    <option value="john-smith">John Smith - Engineering</option>
                                    <option value="maria-johnson">Maria Johnson - Marketing</option>
                                    <option value="robert-brown">Robert Brown - Sales</option>
                                    <option value="sarah-davis">Sarah Davis - HR</option>
                                    <option value="alex-lee">Alex Lee - Finance</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="addOvertimeDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="addOvertimeDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="addStartTime" class="form-label">Start Time</label>
                                <input type="time" class="form-control" id="addStartTime" required>
                            </div>
                            <div class="col-md-6">
                                <label for="addEndTime" class="form-label">End Time</label>
                                <input type="time" class="form-control" id="addEndTime" required>
                            </div>
                            <div class="col-md-6">
                                <label for="addReason" class="form-label">Reason</label>
                                <select class="form-select" id="addReason" required>
                                    <option value="">Select Reason</option>
                                    <option value="project-deadline">Project Deadline</option>
                                    <option value="client-meeting">Client Meeting</option>
                                    <option value="system-maintenance">System Maintenance</option>
                                    <option value="training">Training Session</option>
                                    <option value="month-end">Month-end Closing</option>
                                    <option value="emergency">Emergency Work</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="addPriority" class="form-label">Priority</label>
                                <select class="form-select" id="addPriority" required>
                                    <option value="">Select Priority</option>
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label for="addDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="addDescription" rows="3" placeholder="Detailed description of the overtime work..." required></textarea>
                            </div>
                            <div class="col-12">
                                <label for="addJustification" class="form-label">Business Justification</label>
                                <textarea class="form-control" id="addJustification" rows="2" placeholder="Why is this overtime necessary?"></textarea>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="addUrgent">
                                    <label class="form-check-label" for="addUrgent">
                                        This is an urgent request requiring immediate approval
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="saveOvertimeRequest">Submit Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View/Edit Overtime Request Modal -->
    <div class="modal fade" id="viewOvertimeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Overtime Request Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Employee Information</h6>
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="user-avatar me-3">JS</div>
                                        <div>
                                            <div class="fw-medium" id="viewEmployeeName">John Smith</div>
                                            <small class="text-muted" id="viewEmployeeRole">Engineering - Manager</small>
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <small class="text-muted">Employee ID</small>
                                            <div class="fw-medium" id="viewEmployeeId">EMP-001</div>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Department</small>
                                            <div class="fw-medium" id="viewDepartment">Engineering</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Overtime Details</h6>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <small class="text-muted">Date</small>
                                            <div class="fw-medium" id="viewOvertimeDate">Jan 16, 2025</div>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Time Range</small>
                                            <div class="fw-medium" id="viewTimeRange">5:00 PM - 9:00 PM</div>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Total Hours</small>
                                            <div class="fw-medium text-info" id="viewTotalHours">4.0 hrs</div>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Status</small>
                                            <span class="status-badge pending" id="viewStatus">Pending</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Request Information</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <small class="text-muted">Reason</small>
                                            <div class="fw-medium" id="viewReason">Project Deadline</div>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">Priority</small>
                                            <div class="fw-medium" id="viewPriority">High</div>
                                        </div>
                                        <div class="col-12">
                                            <small class="text-muted">Description</small>
                                            <div class="fw-medium" id="viewDescription">Critical deployment for client project that must be completed before tomorrow's presentation.</div>
                                        </div>
                                        <div class="col-12">
                                            <small class="text-muted">Business Justification</small>
                                            <div class="fw-medium" id="viewJustification">Client has moved up the deadline and this work is critical for project success.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Supervisor Notes</h6>
                                    <textarea class="form-control" id="supervisorNotes" rows="3" placeholder="Add supervisor notes here..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="rejectRequest">Reject</button>
                    <button type="button" class="btn btn-success" id="approveRequest">Approve</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approval Confirmation Modal -->
    <div class="modal fade" id="approvalModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="approvalModalTitle">Confirm Approval</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-check-circle text-success mb-3" style="font-size: 48px;" id="approvalIcon"></i>
                        <h6 id="approvalMessage">Are you sure you want to approve this overtime request?</h6>
                        <div class="mt-3 p-3 bg-light rounded">
                            <div class="fw-bold" id="approvalEmployeeName">John Smith</div>
                            <div class="text-muted" id="approvalDetails">Jan 16, 2025 - 5:00 PM to 9:00 PM (4.0 hrs)</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="confirmApproval">Confirm Approval</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize overtime requests functionality
        function initOvertimeRequests() {
            setupSearch();
            setupFilters();
            setupTableInteractions();
            setupModals();
            addInteractiveEffects();
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('overtimeSearch');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim().toLowerCase();
                filterRequests();
                
                // Visual feedback
                if (searchTerm.length > 0) {
                    this.style.borderColor = '#10b981';
                    setTimeout(() => {
                        this.style.borderColor = '#d1d5db';
                    }, 1000);
                }
            });
        }

        // Filter functionality
        function setupFilters() {
            const filters = ['dateFilter', 'statusFilter', 'departmentFilter'];
            
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                filter.addEventListener('change', filterRequests);
            });
            
            // Clear filters
            document.getElementById('clearFilters').addEventListener('click', function() {
                filters.forEach(filterId => {
                    if (filterId !== 'dateFilter') {
                        document.getElementById(filterId).value = '';
                    }
                });
                document.getElementById('overtimeSearch').value = '';
                filterRequests();
                
                // Visual feedback
                this.textContent = 'Cleared!';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-times me-2"></i>Clear Filters';
                }, 1000);
            });
        }

        // Filter requests based on search and filter criteria
        function filterRequests() {
            const searchTerm = document.getElementById('overtimeSearch').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            const rows = document.querySelectorAll('#overtimeTableBody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const employeeName = row.querySelector('.user-name').textContent.toLowerCase();
                const employeeEmail = row.querySelector('.user-email').textContent.toLowerCase();
                const department = row.querySelector('.department-badge').textContent.toLowerCase();
                const status = row.querySelector('.status-badge').textContent.toLowerCase();
                
                const matchesSearch = employeeName.includes(searchTerm) || employeeEmail.includes(searchTerm);
                const matchesDepartment = !departmentFilter || department === departmentFilter;
                const matchesStatus = !statusFilter || status === statusFilter;
                
                if (matchesSearch && matchesDepartment && matchesStatus) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update showing info
            const showingInfo = document.querySelector('.showing-info');
            showingInfo.textContent = `Showing 1-${visibleCount} of 23 overtime requests`;
        }

        // Table interactions
        function setupTableInteractions() {
            // Approve buttons
            const approveButtons = document.querySelectorAll('.action-buttons .btn-outline-success');
            approveButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const employeeName = row.querySelector('.user-name').textContent;
                    const dateDisplay = row.querySelector('.date-display .fw-medium').textContent;
                    const timeRange = row.querySelector('.time-range .fw-medium').textContent;
                    const otHours = row.querySelector('.ot-hours .fw-medium').textContent;
                    
                    // Set up approval modal
                    document.getElementById('approvalModalTitle').textContent = 'Confirm Approval';
                    document.getElementById('approvalIcon').className = 'fas fa-check-circle text-success mb-3';
                    document.getElementById('approvalMessage').textContent = 'Are you sure you want to approve this overtime request?';
                    document.getElementById('approvalEmployeeName').textContent = employeeName;
                    document.getElementById('approvalDetails').textContent = `${dateDisplay} - ${timeRange} (${otHours})`;
                    document.getElementById('confirmApproval').className = 'btn btn-success';
                    document.getElementById('confirmApproval').textContent = 'Confirm Approval';
                    
                    const modal = new bootstrap.Modal(document.getElementById('approvalModal'));
                    modal.show();
                    
                    console.log(`Approving overtime request for: ${employeeName}`);
                });
            });
            
            // Reject buttons
            const rejectButtons = document.querySelectorAll('.action-buttons .btn-outline-danger');
            rejectButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const employeeName = row.querySelector('.user-name').textContent;
                    const dateDisplay = row.querySelector('.date-display .fw-medium').textContent;
                    const timeRange = row.querySelector('.time-range .fw-medium').textContent;
                    const otHours = row.querySelector('.ot-hours .fw-medium').textContent;
                    
                    // Set up rejection modal
                    document.getElementById('approvalModalTitle').textContent = 'Confirm Rejection';
                    document.getElementById('approvalIcon').className = 'fas fa-times-circle text-danger mb-3';
                    document.getElementById('approvalMessage').textContent = 'Are you sure you want to reject this overtime request?';
                    document.getElementById('approvalEmployeeName').textContent = employeeName;
                    document.getElementById('approvalDetails').textContent = `${dateDisplay} - ${timeRange} (${otHours})`;
                    document.getElementById('confirmApproval').className = 'btn btn-danger';
                    document.getElementById('confirmApproval').textContent = 'Confirm Rejection';
                    
                    const modal = new bootstrap.Modal(document.getElementById('approvalModal'));
                    modal.show();
                    
                    console.log(`Rejecting overtime request for: ${employeeName}`);
                });
            });
            
            // View details buttons
            const viewButtons = document.querySelectorAll('.action-buttons .btn-outline-primary');
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const employeeName = row.querySelector('.user-name').textContent;
                    
                    // Populate view modal with request data
                    populateViewModal(row);
                    
                    const modal = new bootstrap.Modal(document.getElementById('viewOvertimeModal'));
                    modal.show();
                    
                    console.log(`Viewing overtime request details for: ${employeeName}`);
                });
            });
            
            // Edit buttons
            const editButtons = document.querySelectorAll('.action-buttons .btn-outline-warning');
            editButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    const employeeName = row.querySelector('.user-name').textContent;
                    
                    // Populate view modal with request data for editing
                    populateViewModal(row);
                    
                    const modal = new bootstrap.Modal(document.getElementById('viewOvertimeModal'));
                    modal.show();
                    
                    console.log(`Editing overtime request for: ${employeeName}`);
                });
            });
            
            // Export and refresh buttons
            const exportBtn = document.querySelector('.btn-outline-primary');
            const refreshBtn = document.getElementById('refreshRequests');
            
            if (exportBtn && exportBtn.textContent.includes('Export')) {
                exportBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Exporting...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-download me-1"></i>Export';
                        this.disabled = false;
                    }, 2000);
                });
            }
            
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Refreshing...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-sync me-1"></i>Refresh';
                        this.disabled = false;
                    }, 1500);
                });
            }
        }

        // Setup modals
        function setupModals() {
            // Add Overtime Request button
            const addOvertimeBtn = document.querySelector('.add-overtime-btn');
            addOvertimeBtn.addEventListener('click', function() {
                // Set default date to today
                document.getElementById('addOvertimeDate').value = new Date().toISOString().split('T')[0];
                
                const modal = new bootstrap.Modal(document.getElementById('addOvertimeModal'));
                modal.show();
            });
            
            // Save overtime request
            const saveOvertimeRequestBtn = document.getElementById('saveOvertimeRequest');
            saveOvertimeRequestBtn.addEventListener('click', function() {
                const form = document.getElementById('addOvertimeForm');
                if (form.checkValidity()) {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        this.innerHTML = 'Submit Request';
                        this.disabled = false;
                        const modal = bootstrap.Modal.getInstance(document.getElementById('addOvertimeModal'));
                        modal.hide();
                        form.reset();
                        console.log('New overtime request submitted successfully');
                    }, 1500);
                } else {
                    form.reportValidity();
                }
            });
            
            // Approve/Reject request from view modal
            const approveRequestBtn = document.getElementById('approveRequest');
            const rejectRequestBtn = document.getElementById('rejectRequest');
            
            approveRequestBtn.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Approving...';
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = 'Approve';
                    this.disabled = false;
                    const modal = bootstrap.Modal.getInstance(document.getElementById('viewOvertimeModal'));
                    modal.hide();
                    console.log('Overtime request approved');
                }, 1500);
            });
            
            rejectRequestBtn.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Rejecting...';
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = 'Reject';
                    this.disabled = false;
                    const modal = bootstrap.Modal.getInstance(document.getElementById('viewOvertimeModal'));
                    modal.hide();
                    console.log('Overtime request rejected');
                }, 1500);
            });
            
            // Confirm approval/rejection
            const confirmApprovalBtn = document.getElementById('confirmApproval');
            confirmApprovalBtn.addEventListener('click', function() {
                const isApproval = this.textContent.includes('Approval');
                const action = isApproval ? 'Approving' : 'Rejecting';
                
                this.innerHTML = `<i class="fas fa-spinner fa-spin me-2"></i>${action}...`;
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = isApproval ? 'Confirm Approval' : 'Confirm Rejection';
                    this.disabled = false;
                    const modal = bootstrap.Modal.getInstance(document.getElementById('approvalModal'));
                    modal.hide();
                    console.log(`Overtime request ${isApproval ? 'approved' : 'rejected'}`);
                }, 1500);
            });
            
            // Time calculation
            setupTimeCalculation();
        }

        // Populate view modal with request data
        function populateViewModal(row) {
            const employeeName = row.querySelector('.user-name').textContent;
            const department = row.querySelector('.department-badge').textContent;
            const dateDisplay = row.querySelector('.date-display .fw-medium').textContent;
            const timeRange = row.querySelector('.time-range .fw-medium').textContent;
            const otHours = row.querySelector('.ot-hours .fw-medium').textContent;
            const reason = row.querySelector('.reason-text .fw-medium').textContent;
            const status = row.querySelector('.status-badge').textContent;
            
            // Update modal content
            document.getElementById('viewEmployeeName').textContent = employeeName;
            document.getElementById('viewEmployeeRole').textContent = `${department} - Manager`;
            document.getElementById('viewEmployeeId').textContent = 'EMP-001';
            document.getElementById('viewDepartment').textContent = department;
            document.getElementById('viewOvertimeDate').textContent = dateDisplay;
            document.getElementById('viewTimeRange').textContent = timeRange;
            document.getElementById('viewTotalHours').textContent = otHours;
            document.getElementById('viewStatus').textContent = status;
            document.getElementById('viewStatus').className = `status-badge ${status.toLowerCase()}`;
            document.getElementById('viewReason').textContent = reason;
            document.getElementById('viewPriority').textContent = 'High';
            document.getElementById('viewDescription').textContent = 'Critical deployment for client project that must be completed before tomorrow\'s presentation.';
            document.getElementById('viewJustification').textContent = 'Client has moved up the deadline and this work is critical for project success.';
        }

        // Setup time calculation
        function setupTimeCalculation() {
            const startTimeInput = document.getElementById('addStartTime');
            const endTimeInput = document.getElementById('addEndTime');
            
            function calculateOvertimeHours() {
                if (startTimeInput.value && endTimeInput.value) {
                    const startTime = new Date(`2000-01-01 ${startTimeInput.value}`);
                    const endTime = new Date(`2000-01-01 ${endTimeInput.value}`);
                    
                    let diffMs = endTime - startTime;
                    if (diffMs < 0) {
                        // Handle overnight shift
                        diffMs += 24 * 60 * 60 * 1000;
                    }
                    
                    const hours = diffMs / (1000 * 60 * 60);
                    console.log(`Calculated overtime hours: ${hours.toFixed(1)}`);
                }
            }
            
            startTimeInput.addEventListener('change', calculateOvertimeHours);
            endTimeInput.addEventListener('change', calculateOvertimeHours);
        }

        // Add interactive effects
        function addInteractiveEffects() {
            // Table row hover effects
            const tableRows = document.querySelectorAll('#overtimeTableBody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8f9fa';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            });
            
            // Status badge hover effects
            const statusBadges = document.querySelectorAll('.status-badge');
            statusBadges.forEach(badge => {
                badge.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.05)';
                });
                
                badge.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                });
            });
            
            // Action button hover effects
            const actionButtons = document.querySelectorAll('.action-buttons .btn');
            actionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initOvertimeRequests();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('overtimeSearch').focus();
            }
            
            // Escape to clear search
            if (e.key === 'Escape') {
                const searchInput = document.getElementById('overtimeSearch');
                if (document.activeElement === searchInput) {
                    searchInput.value = '';
                    filterRequests();
                    searchInput.blur();
                }
            }
            
            // Ctrl/Cmd + N to add new overtime request
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                document.querySelector('.add-overtime-btn').click();
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}